<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedido Online - Lanchonete</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <h1>Pedido Online - Lanchonete</h1>

    <form id="formPedido" action="processa_pedido.php" method="POST" enctype="application/x-www-form-urlencoded">

        <!-- Dados do cliente -->
        <label for="nome">Nome Completo:</label>
        <input type="text" id="nome" name="nome" placeholder="Digite seu nome completo" required>

        <label for="telefone">Telefone:</label>
        <input type="tel" id="telefone" name="telefone" placeholder="21 999999999" 
               pattern="\(\d{2}\)\s\d{5}-\d{4}" title="Formato: 21 999999999" required>

        <!-- CEP e endere√ßo -->
        <label for="cep">CEP:</label>
        <input type="text" id="cep" name="cep" placeholder="Digite seu CEP" maxlength="8" required>
        <button type="button" onclick="buscarCEP()">Buscar CEP</button>

        <label for="endereco">Endere√ßo de Entrega:</label>
        <input type="text" id="endereco" name="endereco" placeholder="Rua, n√∫mero, bairro" required>

        <label for="numero">N¬∫ residencia:</label>
        <input type="number" id="n√∫mero" name="n√∫mero" placeholder="999" required>

        <label for="complemento">Complemento:</label>
        <input type="text" id="complemento" name="complemento" placeholder="ex:Lote2" required>

        <!-- Carrinho de Compras -->
        <h2>Adicionar Itens ao Pedido</h2>

        <label for="produto">Produto:</label>
        <select id="produto">
            <option value="" disabled selected>Selecione um item</option>
            <option value="Pizza">üçï Pizza</option>
            <option value="Hamburguer">üçî Hamb√∫rguer</option>
            <option value="Pastel">ü•ü Pastel</option>
            <option value="Refrigerante">ü•§ Refrigerante</option>
        </select>

        <!-- Ingredientes din√¢micos -->
        <div id="ingredientesBox" style="margin:10px 0; display:none;">
            <label>Ingredientes:</label><br>
            <div id="listaIngredientes"></div>
        </div>

        <!-- Refrigerantes -->
        <div id="refrigerantesBox" style="margin:10px 0; display:none;">
            <label for="saborRefri">Sabor do Refrigerante:</label>
            <select id="saborRefri">
                <option value="Coca-Cola">Coca-Cola</option>
                <option value="Guaran√°">Guaran√°</option>
                <option value="Fanta Laranja">Fanta Laranja</option>
                <option value="Sprite">Sprite</option>
            </select>
        </div>

        <label for="sabor">Sabor/Descri√ß√£o:</label>
        <input type="text" id="sabor" placeholder="Ex: Calabresa, X-Bacon, Frango c/ queijo">

        <label for="quantidade">Quantidade:</label>
        <input type="number" id="quantidade" min="1" value="1">

        <button type="button" onclick="adicionarItem()">Adicionar ao Pedido</button>

        <h3>Carrinho de Compras</h3>
        <table id="tabelaCarrinho" border="1" style="width:100%; margin-top:10px;">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Ingredientes/Sabor</th>
                    <th>Quantidade</th>
                    <th>Pre√ßo Unit.</th>
                    <th>Total</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div id="itensOcultos"></div>

        <script>
            let carrinho = [];

            // Ingredientes pr√©-definidos
            const ingredientes = {
                "Pizza": ["Massa", "Molho de tomate da casa", "Queijo", "Or√©gano", "Calabresa", "Frango", "Presunto", "Milho", "Bacon", "Azeitona"],
                "Hamburguer": ["P√£o", "Carne", "Queijo", "Alface", "Tomate", "Bacon", "Maionese"],
                "Pastel": ["Queijo", "Carne", "Frango", "Calabresa", "Palmito", "Chocolate"]
            };

            // Pre√ßos aleat√≥rios para cada produto
            const precos = {
                "Pizza": () => (Math.random() * 30 + 20).toFixed(2), // 20 a 50
                "Hamburguer": () => (Math.random() * 15 + 10).toFixed(2), // 10 a 25
                "Pastel": () => (Math.random() * 8 + 5).toFixed(2), // 5 a 13
                "Refrigerante": () => (Math.random() * 6 + 4).toFixed(2) // 4 a 10
            };

            document.getElementById("produto").addEventListener("change", function(){
                const produto = this.value;
                const ingredientesBox = document.getElementById("ingredientesBox");
                const listaIngredientes = document.getElementById("listaIngredientes");
                const refrigerantesBox = document.getElementById("refrigerantesBox");

                listaIngredientes.innerHTML = "";
                ingredientesBox.style.display = "none";
                refrigerantesBox.style.display = "none";

                if (ingredientes[produto]) {
                    ingredientesBox.style.display = "block";
                    ingredientes[produto].forEach(ing => {
                        listaIngredientes.innerHTML += 
                            `<label><input type="checkbox" value="${ing}"> ${ing}</label><br>`;
                    });
                } else if (produto === "Refrigerante") {
                    refrigerantesBox.style.display = "block";
                }
            });

            function adicionarItem() {
                const produto = document.getElementById("produto").value;
                const sabor = document.getElementById("sabor").value.trim();
                const quantidade = parseInt(document.getElementById("quantidade").value);

                let descricao = sabor;

                if (ingredientes[produto]) {
                    const selecionados = Array.from(document.querySelectorAll("#listaIngredientes input:checked"))
                                            .map(cb => cb.value);
                    if (selecionados.length > 0) {
                        descricao = (descricao ? descricao + " - " : "") + selecionados.join(", ");
                    }
                } else if (produto === "Refrigerante") {
                    descricao = document.getElementById("saborRefri").value;
                }

                if (!produto || !descricao || quantidade < 1) {
                    alert("Preencha todos os campos corretamente.");
                    return;
                }

                const precoUnit = parseFloat(precos[produto]());
                const total = (precoUnit * quantidade).toFixed(2);

                carrinho.push({produto, descricao, quantidade, precoUnit, total});
                atualizarCarrinho();
                limparCamposItem();
            }

            function atualizarCarrinho() {
                const tbody = document.querySelector("#tabelaCarrinho tbody");
                tbody.innerHTML = "";
                const itensOcultos = document.getElementById("itensOcultos");
                itensOcultos.innerHTML = "";

                carrinho.forEach((item,index)=>{
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${item.produto}</td>
                        <td>${item.descricao}</td>
                        <td>${item.quantidade}</td>
                        <td>R$ ${item.precoUnit}</td>
                        <td>R$ ${item.total}</td>
                        <td><button type="button" onclick="removerItem(${index})">Remover</button></td>
                    `;
                    tbody.appendChild(tr);

                    for(const key in item){
                        const input = document.createElement("input");
                        input.type = "hidden";
                        input.name = `itens[${index}][${key}]`;
                        input.value = item[key];
                        itensOcultos.appendChild(input);
                    }
                });
            }

            function removerItem(index){
                carrinho.splice(index,1);
                atualizarCarrinho();
            }

            function limparCamposItem(){
                document.getElementById("produto").selectedIndex = 0;
                document.getElementById("sabor").value = "";
                document.getElementById("quantidade").value = 1;
                document.getElementById("ingredientesBox").style.display = "none";
                document.getElementById("refrigerantesBox").style.display = "none";
            }

            async function buscarCEP() {
                const cep = document.getElementById("cep").value.replace(/\D/g, "");
                if (!cep || cep.length !== 8) {
                    alert("Digite um CEP v√°lido com 8 n√∫meros.");
                    return;
                }

                const enderecoInput = document.getElementById("endereco");
                enderecoInput.value = "Buscando...";

                try {
                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                    const data = await response.json();

                    if (data.erro) {
                        enderecoInput.value = "";
                        alert("CEP n√£o encontrado.");
                        return;
                    }

                    enderecoInput.value = `${data.logradouro}, ${data.bairro}, ${data.localidade} - ${data.uf}`;
                } catch (error) {
                    enderecoInput.value = "";
                    alert("Erro ao buscar o CEP. Tente novamente.");
                    console.error(error);
                }
            }
        </script>

        <!-- Observa√ß√µes -->
        <label for="observacoes">Observa√ß√µes:</label>
        <textarea id="observacoes" name="observacoes" placeholder="Ex: Sem cebola, cortar em 8 peda√ßos..."></textarea>

        <!-- Forma de pagamento -->
        <h2>Pagamento</h2>
        <label>Forma de pagamento:</label><br>
        <label><input type="radio" name="pagamento" value="VR" required> VR</label><br>
        <label><input type="radio" name="pagamento" value="D√©bito"> D√©bito</label><br>
        <label><input type="radio" name="pagamento" value="Cr√©dito"> Cr√©dito</label><br>
        <label><input type="radio" name="pagamento" value="Pix"> Pix</label><br>

        <label>Tipo de pagamento:</label><br>
        <label><input type="radio" name="tipo_pagamento" value="Online" required> Online</label><br>
        <label><input type="radio" name="tipo_pagamento" value="Na Entrega"> Na Entrega</label><br>

        <!-- Bot√µes -->
        <button type="submit" class="btn-submit">Enviar Pedido</button>
        <button type="reset" class="btn-reset">Limpar Formul√°rio</button>

    </form>

</body>
</html>
