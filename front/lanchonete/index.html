<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedido Online - Lanchonete</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="main-content">
        <h1>JORGIN LANCHES</h1>
    
        <form id="formPedido" action="processa_pedido.php" method="POST" enctype="application/x-www-form-urlencoded">

            <fieldset class="form-group">
                <legend>Dados do Cliente</legend>
                <label for="nome">Nome Completo:</label>
                <input type="text" id="nome" name="nome" placeholder="Digite seu nome completo" required>

                <label for="telefone">Telefone:</label>
                <input type="tel" id="telefone" name="telefone" placeholder="(21) 99999-9999" 
                       pattern="\(\d{2}\)\s\d{5}-\d{4}" title="Formato: (21) 99999-9999" required>
            </fieldset>

            <fieldset class="form-group">
                <legend>Endereço de Entrega</legend>
                <label for="cep">CEP:</label>
                <div class="input-com-botao">
                    <input type="text" id="cep" name="cep" placeholder="Digite seu CEP" maxlength="8" required>
                    <button type="button" class="btn-cep" onclick="buscarCEP()">Buscar</button>
                </div>
                
                <label for="endereco">Endereço:</label>
                <input type="text" id="endereco" name="endereco" placeholder="Rua, bairro, cidade" required>

                <label for="numero">Nº Residência:</label>
                <input type="number" id="numero" name="numero" placeholder="999" required>

                <label for="complemento">Complemento:</label>
                <input type="text" id="complemento" name="complemento" placeholder="Ex: Lote 2, Apto 101">
            </fieldset>

            <fieldset class="form-group">
                <legend>Adicionar Itens ao Pedido</legend>

                <label for="produto">Produto:</label>
                <select id="produto">
                    <option value="" disabled selected>Selecione um item</option>
                    <option value="Pizza">🍕 Pizza</option>
                    <option value="Hamburguer">🍔 Hambúrguer</option>
                    <option value="Pastel Tradicional">🥟 Pastel Tradicional</option>
                    <option value="Pastel Tudo Dentro">🥟 Pastel "Com Tudo Dentro"</option>
                    <option value="Refrigerante">🥤 Refrigerante</option>
                    <option value="Guaracamp">🥤 Guaracamp</option>
                </select>

                <div id="opcoesPizza" class="item-opcoes" style="display:none;">
                    <h4>Ingredientes base: <span class="ingredientes-base">Massa, Molho de tomate, Mussarela</span></h4>
                    <div class="sabor-selection">
                        <label>Selecione 1º Sabor:</label>
                        <select id="saborPizza1"></select>
                        <label>Selecione 2º Sabor (opcional):</label>
                        <select id="saborPizza2"></select>
                    </div>
                </div>

                <div id="opcoesHamburguer" class="item-opcoes" style="display:none;">
                    <label>Ingredientes:</label>
                    <div id="ingredientesHamburguer" class="checkbox-group"></div>
                    <label>Molhos:</label>
                    <div id="molhosHamburguer" class="checkbox-group"></div>
                </div>

                <div id="opcoesPastel" class="item-opcoes" style="display:none;">
                    <div id="pastelTradicional" style="display:none;">
                        <label>Sabor (Escolha 1):</label>
                        <div id="saboresPastelTradicional" class="radio-group"></div>
                    </div>
                    <div id="pastelTudoDentro" style="display:none;">
                        <label>Ingredientes (até 10):</label>
                        <div id="ingredientesPastel" class="checkbox-group"></div>
                    </div>
                </div>

                <div id="opcoesRefrigerante" class="item-opcoes" style="display:none;">
                    <label for="tamanhoRefri">Tamanho:</label>
                    <select id="tamanhoRefri"></select>
                    <label for="saborRefri">Sabor:</label>
                    <select id="saborRefri"></select>
                </div>
                
                <div id="opcoesGuaracamp" class="item-opcoes" style="display:none;">
                    <label>Este produto não tem opções de personalização.</label>
                </div>

                <label for="quantidade">Quantidade:</label>
                <input type="number" id="quantidade" min="1" value="1">

                <button type="button" class="btn-adicionar" onclick="adicionarItem()">Adicionar ao Pedido</button>

                <h3>Carrinho de Compras</h3>
                <div class="table-responsive">
                    <table id="tabelaCarrinho" class="table-hover">
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Descrição</th>
                                <th>Qtd.</th>
                                <th>Preço Unit.</th>
                                <th>Total</th>
                                <th>Ações</th>
                            </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div id="itensOcultos"></div>
        </fieldset>

        <fieldset class="form-group">
            <legend>Detalhes Adicionais</legend>
            <label for="observacoes">Observações:</label>
            <textarea id="observacoes" name="observacoes" placeholder="Ex: Sem cebola, cortar em 8 pedaços..."></textarea>
        </fieldset>

        <fieldset class="form-group">
            <legend>Pagamento</legend>
            <label>Forma de pagamento:</label>
            <div class="radio-group">
                <label><input type="radio" name="pagamento" value="VR" required> VR</label>
                <label><input type="radio" name="pagamento" value="Débito"> Débito</label>
                <label><input type="radio" name="pagamento" value="Crédito"> Crédito</label>
                <label><input type="radio" name="pagamento" value="Pix"> Pix</label>
            </div>
            
            <label>Tipo de pagamento:</label>
            <div class="radio-group">
                <label><input type="radio" name="tipo_pagamento" value="Online" required> Online</label>
                <label><input type="radio" name="tipo_pagamento" value="Na Entrega"> Na Entrega</label>
            </div>
        </fieldset>

        <div class="botoes-form">
            <button type="submit" class="btn-submit animate-btn">Enviar Pedido</button>
            <button type="reset" class="btn-reset animate-btn">Limpar Formulário</button>
        </div>
    </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const carrinho = [];
            
            // Dados dos produtos
            const produtos = {
                "Pizza": {
                    sabores: {
                        "Calabresa": {
                            nome: "Calabresa",
                            ingredientes: "linguiça calabresa fatiada, cebola e azeitonas"
                        },
                        "Frango com Catupiry": {
                            nome: "Frango com Catupiry",
                            ingredientes: "frango desfiado e temperado com catupiry cremoso"
                        },
                        "Portuguesa": {
                            nome: "Portuguesa",
                            ingredientes: "presunto, ovo cozido, cebola, azeitona e pimentão"
                        },
                        "Quatro Queijos": {
                            nome: "Quatro Queijos",
                            ingredientes: "gorgonzola, parmesão, provolone e mussarela"
                        },
                        "Marguerita": {
                            nome: "Marguerita",
                            ingredientes: "rodelas de tomate e manjericão fresco"
                        },
                        "Bacon": {
                            nome: "Bacon",
                            ingredientes: "bacon crocante e milho"
                        }
                    },
                    ingredientesBase: "Massa, Molho de tomate da casa, Mussarela"
                },
                "Hamburguer": {
                    ingredientes: ["Pão", "Carne", "Queijo", "Alface", "Tomate", "Bacon", "Cebola Roxa"],
                    molhos: ["Ketchup", "Maionese", "Mostarda", "Barbecue", "Maionese Verde", "Billy Jack"]
                },
                "Pastel Tradicional": {
                    sabores: ["Queijo", "Carne", "Frango", "Calabresa", "Palmito", "Chocolate"]
                },
                "Pastel Tudo Dentro": {
                    ingredientes: ["Carne", "Queijo", "Frango", "Calabresa", "Palmito", "Ovo", "Milho", "Azeitona", "Catupiry", "Bacon", "Cebola"]
                },
                "Refrigerante": {
                    tamanhos: ["Lata 350ml", "1L", "2L"],
                    sabores: ["Coca-Cola", "Guaraná", "Fanta Laranja", "Sprite"]
                },
                "Guaracamp": {}
            };

            // Preços
            const precos = {
                "Pizza": () => (Math.random() * 30 + 20).toFixed(2), 
                "Hamburguer": () => (Math.random() * 15 + 10).toFixed(2), 
                "Pastel Tradicional": () => (Math.random() * 8 + 5).toFixed(2), 
                "Pastel Tudo Dentro": () => (Math.random() * 12 + 8).toFixed(2), 
                "Refrigerante": (tamanho) => {
                    if (tamanho === "Lata 350ml") return (Math.random() * 3 + 4).toFixed(2);
                    if (tamanho === "1L") return (Math.random() * 4 + 6).toFixed(2);
                    if (tamanho === "2L") return (Math.random() * 5 + 8).toFixed(2);
                },
                "Guaracamp": () => (Math.random() * 2 + 2).toFixed(2)
            };

            // Referências de elementos
            const produtoSelect = document.getElementById("produto");
            const opcoes = {
                pizza: document.getElementById("opcoesPizza"),
                hamburguer: document.getElementById("opcoesHamburguer"),
                pastel: document.getElementById("opcoesPastel"),
                refrigerante: document.getElementById("opcoesRefrigerante"),
                guaracamp: document.getElementById("opcoesGuaracamp")
            };
            const listaIngredientesHamburguer = document.getElementById("ingredientesHamburguer");
            const listaMolhosHamburguer = document.getElementById("molhosHamburguer");
            const listaSaboresPastelTradicional = document.getElementById("saboresPastelTradicional");
            const listaIngredientesPastel = document.getElementById("ingredientesPastel");
            const saborPizza1 = document.getElementById("saborPizza1");
            const saborPizza2 = document.getElementById("saborPizza2");
            const tamanhoRefri = document.getElementById("tamanhoRefri");
            const saborRefri = document.getElementById("saborRefri");
            const quantidadeInput = document.getElementById("quantidade");
            const tabelaCarrinho = document.getElementById("tabelaCarrinho");
            const itensOcultos = document.getElementById("itensOcultos");
            const formPedido = document.getElementById("formPedido");

            // Popula os campos dinâmicos
            const popularSelect = (select, options) => {
                select.innerHTML = '<option value="" disabled selected>Selecione</option>';
                options.forEach(option => {
                    const opt = document.createElement("option");
                    opt.value = opt.textContent = option.nome || option;
                    opt.setAttribute('data-ingredientes', option.ingredientes || '');
                    select.appendChild(opt);
                });
            };

            const popularCheckboxes = (div, options, max) => {
                div.innerHTML = "";
                options.forEach(option => {
                    div.innerHTML += `<label><input type="checkbox" value="${option}"> ${option}</label>`;
                });
                if (max) {
                    const checkboxes = div.querySelectorAll('input[type="checkbox"]');
                    checkboxes.forEach(cb => {
                        cb.addEventListener('change', () => {
                            const selecionados = div.querySelectorAll('input[type="checkbox"]:checked').length;
                            if (selecionados > max) {
                                cb.checked = false;
                                alert(`Você pode selecionar no máximo ${max} ingredientes.`);
                            }
                        });
                    });
                }
            };
            
            const popularRadios = (div, options) => {
                div.innerHTML = "";
                options.forEach(option => {
                    div.innerHTML += `<label><input type="radio" name="saborPastelTrad" value="${option}"> ${option}</label>`;
                });
            };

            // Event listener para o select de produto
            produtoSelect.addEventListener("change", (event) => {
                const produto = event.target.value;
                Object.values(opcoes).forEach(op => op.style.display = "none");
                
                if (produto.startsWith("Pastel")) {
                    opcoes.pastel.style.display = "block";
                    document.getElementById("pastelTradicional").style.display = produto === "Pastel Tradicional" ? "block" : "none";
                    document.getElementById("pastelTudoDentro").style.display = produto === "Pastel Tudo Dentro" ? "block" : "none";
                } else if (opcoes[produto.toLowerCase()]) {
                    opcoes[produto.toLowerCase()].style.display = "block";
                }

                switch(produto) {
                    case "Pizza":
                        popularSelect(saborPizza1, Object.values(produtos.Pizza.sabores));
                        popularSelect(saborPizza2, Object.values(produtos.Pizza.sabores));
                        break;
                    case "Hamburguer":
                        popularCheckboxes(listaIngredientesHamburguer, produtos.Hamburguer.ingredientes);
                        popularCheckboxes(listaMolhosHamburguer, produtos.Hamburguer.molhos);
                        break;
                    case "Pastel Tradicional":
                        popularRadios(listaSaboresPastelTradicional, produtos["Pastel Tradicional"].sabores);
                        break;
                    case "Pastel Tudo Dentro":
                        popularCheckboxes(listaIngredientesPastel, produtos["Pastel Tudo Dentro"].ingredientes, 10);
                        break;
                    case "Refrigerante":
                        popularSelect(tamanhoRefri, produtos.Refrigerante.tamanhos);
                        popularSelect(saborRefri, produtos.Refrigerante.sabores);
                        break;
                    case "Guaracamp":
                        popularSelect(tamanhoRefri, []); // Guaracamp não tem opções de tamanho
                        popularSelect(saborRefri, []); // nem de sabor
                        break;
                }
            });

            // Adicionar item ao carrinho
            window.adicionarItem = () => {
                const produto = produtoSelect.value;
                const quantidade = parseInt(quantidadeInput.value);
                let descricao = "";
                let precoUnit = 0;

                if (!produto || quantidade < 1) {
                    alert("Por favor, selecione um produto e a quantidade.");
                    return;
                }

                switch(produto) {
                    case "Pizza":
                        const sabor1 = saborPizza1.value;
                        const sabor2 = saborPizza2.value;
                        if (!sabor1) { alert("Selecione pelo menos um sabor para a pizza."); return; }
                        
                        const ingredientesSabor1 = produtos.Pizza.sabores[sabor1].ingredientes;
                        const ingredientesSabor2 = sabor2 ? produtos.Pizza.sabores[sabor2].ingredientes : null;
                        
                        descricao = `${produtos.Pizza.ingredientesBase} - Sabores: ${sabor1} (${ingredientesSabor1})` + (sabor2 ? ` e ${sabor2} (${ingredientesSabor2})` : "");
                        precoUnit = parseFloat(precos.Pizza());
                        break;
                    case "Hamburguer":
                        const ingredientesSelecionados = Array.from(listaIngredientesHamburguer.querySelectorAll('input:checked')).map(cb => cb.value);
                        const molhosSelecionados = Array.from(listaMolhosHamburguer.querySelectorAll('input:checked')).map(cb => cb.value);
                        if (ingredientesSelecionados.length === 0) { alert("Selecione pelo menos um ingrediente para o hambúrguer."); return; }
                        descricao = `Ingredientes: ${ingredientesSelecionados.join(", ")}` + (molhosSelecionados.length > 0 ? ` - Molhos: ${molhosSelecionados.join(", ")}` : "");
                        precoUnit = parseFloat(precos.Hamburguer());
                        break;
                    case "Pastel Tradicional":
                        const saborPastelTrad = document.querySelector('input[name="saborPastelTrad"]:checked');
                        if (!saborPastelTrad) { alert("Selecione um sabor para o pastel tradicional."); return; }
                        descricao = saborPastelTrad.value;
                        precoUnit = parseFloat(precos["Pastel Tradicional"]());
                        break;
                    case "Pastel Tudo Dentro":
                        const ingredientesPastel = Array.from(listaIngredientesPastel.querySelectorAll('input:checked')).map(cb => cb.value);
                        if (ingredientesPastel.length === 0) { alert("Selecione pelo menos um ingrediente para o pastel."); return; }
                        descricao = "Pastel " + ingredientesPastel.join(", ");
                        precoUnit = parseFloat(precos["Pastel Tudo Dentro"]());
                        break;
                    case "Refrigerante":
                        const tamanho = tamanhoRefri.value;
                        const sabor = saborRefri.value;
                        if (!tamanho || !sabor) { alert("Selecione o tamanho e o sabor do refrigerante."); return; }
                        descricao = `${sabor} (${tamanho})`;
                        precoUnit = parseFloat(precos.Refrigerante(tamanho));
                        break;
                    case "Guaracamp":
                        descricao = "Guaracamp";
                        precoUnit = parseFloat(precos.Guaracamp());
                        break;
                    default:
                        alert("Produto não selecionado ou inválido.");
                        return;
                }

                const total = (precoUnit * quantidade).toFixed(2);
                carrinho.push({produto, descricao, quantidade, precoUnit, total});
                atualizarCarrinho();
                limparCamposItem();
            }

            window.removerItem = (index) => {
                carrinho.splice(index, 1);
                atualizarCarrinho();
            }

            const atualizarCarrinho = () => {
                const tbody = tabelaCarrinho.querySelector("tbody");
                tbody.innerHTML = "";
                itensOcultos.innerHTML = "";

                carrinho.forEach((item, index) => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${item.produto}</td>
                        <td>${item.descricao}</td>
                        <td>${item.quantidade}</td>
                        <td>R$ ${item.precoUnit}</td>
                        <td>R$ ${item.total}</td>
                        <td><button type="button" class="btn-remover" onclick="removerItem(${index})">Remover</button></td>
                    `;
                    tbody.appendChild(tr);

                    for(const key in item){
                        const input = document.createElement("input");
                        input.type = "hidden";
                        input.name = `itens[${index}][${key}]`;
                        input.value = item[key];
                        itensOcultos.appendChild(input);
                    }
                });
            }

            const limparCamposItem = () => {
                produtoSelect.selectedIndex = 0;
                Object.values(opcoes).forEach(op => op.style.display = "none");
                quantidadeInput.value = 1;
            }

            window.buscarCEP = async () => {
                const cep = document.getElementById("cep").value.replace(/\D/g, "");
                if (cep.length !== 8) {
                    alert("Digite um CEP válido com 8 números.");
                    return;
                }
                
                const enderecoInput = document.getElementById("endereco");
                enderecoInput.value = "Buscando...";

                try {
                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                    const data = await response.json();

                    if (data.erro) {
                        enderecoInput.value = "";
                        alert("CEP não encontrado.");
                        return;
                    }
                    enderecoInput.value = `${data.logradouro}, ${data.bairro}, ${data.localidade} - ${data.uf}`;
                } catch (error) {
                    enderecoInput.value = "";
                    alert("Erro ao buscar o CEP. Tente novamente.");
                    console.error(error);
                }
            }

            formPedido.addEventListener('submit', (event) => {
                if (carrinho.length === 0) {
                    event.preventDefault();
                    alert("O seu carrinho de compras está vazio. Por favor, adicione um item antes de enviar o pedido.");
                }
            });

        });
    </script>

</body>
</html>